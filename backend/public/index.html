<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>justcheckit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #111;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

#app {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.shell {
  width: 100%;
  max-width: 420px;
  padding: 24px;
}

.brand {
  font-size: 28px;
  font-weight: 800;
}

.underline {
  display: flex;
  gap: 6px;
  margin-top: 6px;
}

.underline span {
  flex: 1;
  height: 4px;
  border-radius: 2px;
}

.green { background: #2ecc71; }
.amber { background: #f39c12; }
.red { background: #e74c3c; }

.hidden { display: none; }

input, button {
  width: 100%;
  padding: 14px;
  margin-top: 16px;
  font-size: 15px;
  border-radius: 8px;
  border: none;
}

button.primary {
  background: #fff;
  color: #000;
  font-weight: 600;
}

button.cta {
  background: #f39c12;
  color: #000;
  font-weight: 700;
}

.card {
  background: #1c1c1c;
  padding: 14px;
  border-radius: 10px;
  margin-top: 16px;
}

.muted {
  opacity: 0.7;
  font-size: 13px;
  margin-top: 10px;
}
</style>
</head>

<body>
<div id="app">
  <div class="shell">

    <div class="brand">justcheckit</div>
    <div class="underline">
      <span class="green"></span>
      <span class="amber"></span>
      <span class="red"></span>
    </div>

    <!-- SCREEN 1 -->
    <section id="s1">
      <p style="margin-top:24px;font-size:18px;">
        Before you send money, just check.
      </p>

      <input id="identifier" placeholder="Phone, name, or reference" />
      <button class="primary" onclick="runCheck()">Just check</button>

      <div class="muted">No signup · No subscription</div>
    </section>

    <!-- SCREEN 2 -->
    <section id="s2" class="hidden">
      <p style="margin-top:32px;font-size:18px;">Checking…</p>
      <div class="muted">Scanning available indicators</div>
    </section>

    <!-- SCREEN 3 -->
    <section id="s3" class="hidden">
      <p style="margin-top:32px;font-size:18px;">
        Some risk indicators were detected
      </p>

      <button class="cta" onclick="unlockPaid()">
        Unlock full report for $1.49
      </button>
    </section>

    <!-- SCREEN 5 -->
    <section id="s5" class="hidden">
      <p style="margin-top:32px;font-size:18px;">
        Full report findings
      </p>

      <div class="card">
        <strong>Confidence:</strong>
        <span id="confidence"></span>

        <br><br>
        <strong>Indicators:</strong>
        <ul id="indicators"></ul>
      </div>

      <button class="primary" onclick="location.reload()">
        Run another check
      </button>
    </section>

  </div>
</div>

<script>
function show(id) {
  ["s1","s2","s3","s5"].forEach(s =>
    document.getElementById(s).classList.add("hidden")
  );
  document.getElementById(id).classList.remove("hidden");
}

let cachedIdentifier = "";

async function runCheck() {
  const value = document.getElementById("identifier").value.trim();
  if (!value) return alert("Enter something to check");

  cachedIdentifier = value;
  show("s2");

  try {
    const res = await fetch("/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        identifier: value,
        identifier_type: "generic"
      })
    });

    if (!res.ok) throw new Error("check failed");

    await res.json();
    show("s3");

  } catch (e) {
    alert("Check failed");
    show("s1");
  }
}

async function unlockPaid() {
  show("s2");

  try {
    const init = await fetch("/pay/init", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        identifier: cachedIdentifier,
        identifier_type: "generic"
      })
    });

    const initData = await init.json();

    const confirm = await fetch(
      `/pay/confirm?ref=${encodeURIComponent(initData.payment.ref)}&identifier=${encodeURIComponent(cachedIdentifier)}&identifier_type=generic`
    );

    const data = await confirm.json();

    document.getElementById("confidence").innerText =
      data.report.confidence || "UNKNOWN";

    const ul = document.getElementById("indicators");
    ul.innerHTML = "";

    (data.report.indicators || []).forEach(i => {
      const li = document.createElement("li");
      li.innerText = i.description || i;
      ul.appendChild(li);
    });

    show("s5");

  } catch (e) {
    alert("Paid flow failed");
    show("s3");
  }
}
</script>
</body>
</html>
